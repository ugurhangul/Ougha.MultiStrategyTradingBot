# Backtest Analysis Tools

## Problem Identified

The initial analysis showed **15,172 trades** but couldn't properly identify which strategy each trade belonged to because:

1. The log files don't contain the complete strategy information in a parseable format
2. The strategy key is in the comment field of each trade, but logs only show partial information
3. The SimulatedBroker stores complete trade data including comments, but this wasn't being saved

## Solution

The backtest.py has been updated to save complete trade data to `backtest_trades.pkl` after each run.

### To Get Accurate Analysis:

**Run the backtest again:**

```bash
python backtest.py
```

This will:
1. Run the complete backtest
2. Save all trade data with strategy information to `backtest_trades.pkl`
3. Display summary results

**Then run the detailed analysis:**

```bash
python analyze_backtest_results.py
```

This will:
1. Load trades from `backtest_trades.pkl`
2. Parse the comment field to extract strategy information (TB, FB, HFT + range_id)
3. Calculate performance metrics for each symbol/strategy pair
4. Generate detailed reports showing:
   - Best performing symbol/strategy pairs
   - Worst performing symbol/strategy pairs
   - Performance by symbol (all strategies combined)
   - Performance by strategy (all symbols combined)
5. Export to CSV files for further analysis

## Expected Output

The analysis will show metrics like:

### Top Performers
- Symbol/Strategy pair (e.g., "EURUSD_TB_15M_1M")
- Total trades
- Win rate %
- Total profit
- Profit factor
- Average profit per trade

### Bottom Performers
- Same metrics for worst performing pairs

### By Symbol
- Aggregated performance across all strategies for each symbol

### By Strategy
- Aggregated performance across all symbols for each strategy type

## Files Generated

1. **backtest_trades.pkl** - Complete trade data (generated by backtest.py)
2. **backtest_analysis.csv** - Symbol/strategy pair statistics
3. **backtest_trades.csv** - Individual trade records

## Current Backtest Results (Summary Only)

From your last backtest run:

```
ACCOUNT PERFORMANCE:
  Initial Balance:  $   10,000.00
  Final Balance:    $   14,710.61
  Final Equity:     $   14,325.60
  Total Profit:     $    4,710.61
  Total Return:            50.34%

RISK METRICS:
  Max Drawdown:            49.57%
  Sharpe Ratio:             0.86
  Profit Factor:            1.05

TRADE STATISTICS:
  Total Trades:             7586
  Winning Trades:           3036 (40.0%)
  Losing Trades:            4542 (60.0%)
```

**Note:** The discrepancy between 7,586 trades (from backtest summary) and 15,172 trades (from logs) suggests that the logs may contain duplicate entries or the summary is counting differently. Running the backtest again with the updated code will resolve this.

## Why This Matters

Without knowing which strategy each trade belongs to, you can't:
- Identify which strategies are profitable vs unprofitable
- Determine which symbol/strategy combinations work best
- Make informed decisions about which strategies to enable/disable
- Optimize parameters for specific strategies

The detailed analysis will reveal patterns like:
- "True Breakout on EURUSD with 15M_1M range is profitable"
- "Fakeout on GBPUSD with 4H_5M range is losing money"
- "HFT Momentum works well on crypto but not on forex"

This information is critical for optimizing your trading system.

